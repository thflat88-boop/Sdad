<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>بوابة الدفع - تجريبي (ملف واحد)</title>
  <style>
    /* عام (يحافظ على تصميمك) */
    body{font-family:Arial,Helvetica,sans-serif;direction:rtl;background:#f5f5f5;margin:0;padding:0}
    header, footer{background:#004080;color:#fff;text-align:center;padding:18px 0}
    .wrap{max-width:720px;margin:18px auto;padding:18px}
    .card{background:#fff;border-radius:8px;padding:20px;box-shadow:0 0 10px rgba(0,0,0,0.08);margin-bottom:18px}
    h1{margin:0 0 12px;font-size:20px;color:#0b61c2;text-align:center}
    form{max-width:520px;margin:0 auto}
    label{display:block;margin-top:10px;font-weight:600}
    input, select, button, textarea{width:100%;padding:10px;margin-top:6px;box-sizing:border-box;border-radius:6px;border:1px solid #ddd;font-size:15px}
    button{background:#004080;color:#fff;border:none;cursor:pointer;padding:12px;border-radius:6px;font-weight:700}
    .small{font-size:13px;color:#666;text-align:center;margin-top:12px}
    .dob{display:flex;gap:8px}
    .dob input{flex:1}
    .hidden{display:none}
    .center{text-align:center}
    .row{display:flex;gap:8px;align-items:center}
    .col{flex:1}
    .error{color:#b00020;font-size:13px;display:none;margin-top:8px}
    /* صفحة التأكيد */
    .summary .row{justify-content:space-between;padding:8px 0;border-bottom:1px dashed #eee}
    .summary .label{color:#666}
    .summary .value{font-weight:700}
    /* responsive */
    @media (max-width:600px){
      .wrap{padding:12px}
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap center">
      <div style="font-weight:800">بوابة الدفع الآمنة — تجريبي</div>
    </div>
  </header>

  <main class="wrap">
    <!-- الصفحة 1: بيانات شخصية -->
    <section id="step1" class="card">
      <h1>البيانات الشخصية</h1>
      <form id="personalForm" autocomplete="off" novalidate>
        <input id="logoHidden" type="hidden" value="demo" />
        <label for="fullName">الاسم الكامل</label>
        <input id="fullName" type="text" placeholder="الاسم الكامل" required />

        <label for="idType">نوع الهوية</label>
        <select id="idType" required>
          <option value="">اختر نوع الهوية</option>
          <option value="هوية اماراتية">الهوية الإماراتية</option>
          <option value="جواز سفر">جواز السفر</option>
        </select>

        <label style="margin-top:8px">تاريخ الميلاد (ميلادي)</label>
        <div class="dob">
          <input id="day" type="number" placeholder="يوم" min="1" max="31" required />
          <input id="month" type="number" placeholder="شهر" min="1" max="12" required />
          <input id="year" type="number" placeholder="سنة" min="1900" max="2100" required />
        </div>

        <label for="phone">رقم الجوال</label>
        <input id="phone" type="tel" placeholder="05XXXXXXXX" required />

        <label for="email">البريد الإلكتروني</label>
        <input id="email" type="email" placeholder="example@mail.com" required />

        <div class="error" id="errStep1">الرجاء ملء كل الحقول بشكل صحيح.</div>

        <button id="toStep2" type="button">التالي</button>
        <p class="small">سيتم نقل بياناتك إلى صفحة الدفع التالية لأكمال العملية (تجريبي).</p>
      </form>
    </section>

    <!-- الصفحة 2: نموذج البطاقة (تجريبي — لا ترسل بيانات حساسة) -->
    <section id="step2" class="card hidden">
      <h1>بوابة الدفع الآمنة</h1>
      <form id="paymentForm" novalidate>
        <label for="confirmBooking">تأكيد رقم الحجز (6 أرقام)</label>
        <input id="confirmBooking" type="text" minlength="6" maxlength="6" placeholder="مثال: 123456" oninput="this.value=this.value.replace(/[^0-9]/g,'')" required />

        <div class="error" id="lengthError">❗ رقم الحجز يجب أن يتكون من 6 أرقام فقط.</div>

        <label for="cardNumber">رقم البطاقة (عرضي فقط)</label>
        <input id="cardNumber" type="text" maxlength="19" placeholder="1234-5678-9012-3456" oninput="formatCardNumber(this)" />

        <label for="cardName">الاسم الموجود على البطاقة</label>
        <input id="cardName" type="text" placeholder="اسم حامل البطاقة" />

        <div style="display:flex;gap:8px">
          <div style="flex:1">
            <label for="expiryMonth">الشهر (MM)</label>
            <select id="expiryMonth">
              <option value="">--</option>
              <option>01</option><option>02</option><option>03</option>
              <option>04</option><option>05</option><option>06</option>
              <option>07</option><option>08</option><option>09</option>
              <option>10</option><option>11</option><option>12</option>
            </select>
          </div>
          <div style="flex:1">
            <label for="expiryYear">السنة (YYYY)</label>
            <select id="expiryYear">
              <option value="">--</option>
              <option>2025</option><option>2026</option><option>2027</option>
              <option>2028</option><option>2029</option><option>2030</option>
              <option>2031</option><option>2032</option>
            </select>
          </div>
        </div>

        <label for="cvv">CVV (3 أرقام) — للحقل المعروض فقط</label>
        <input id="cvv" type="text" minlength="3" maxlength="3" placeholder="***" oninput="this.value=this.value.replace(/[^0-9]/g,'')" />

        <div class="error" id="dateError">❗ لأسباب أمنية، لا يمكننا قبول بطاقات منتهية الصلاحية.</div>

        <div style="margin-top:12px">
          <button id="payNow" type="button">ادفع الآن</button>
        </div>
      </form>
      <p class="small center" style="margin-top:12px">هذه الصفحة تجريبية — لا يتم إرسال بيانات البطاقة لأي جهة.</p>
    </section>

    <!-- الصفحة 3: تأكيد / ملخص -->
    <section id="step3" class="card hidden">
      <h1>مراجعة بيانات الدفع (تجريبي)</h1>
      <div class="summary" id="summaryBox">
        <!-- سيتم ملؤها عبر جافاسكربت -->
      </div>

      <div style="display:flex;gap:8px;margin-top:14px">
        <button id="finalContinue" style="flex:1;background:#0b61c2">متابعة</button>
        <button id="editBack" style="flex:1;background:#ddd;color:#111">تعديل</button>
      </div>

      <p class="small" style="margin-top:12px;color:#666">ملاحظة: هذه محاكاة للتدفق فقط. لا نرسل أو نخزن بيانات البطاقة الحساسة.</p>
    </section>
  </main>

  <footer>
    <div class="wrap center">جميع الحقوق محفوظة © 2025</div>
  </footer>

<script>
  // تنسيقات بسيطة ووظائف مساعده
  function formatCardNumber(input){
    let v = input.value.replace(/[^0-9]/g,'').slice(0,16);
    input.value = v.match(/.{1,4}/g)?.join('-') || v;
  }

  // عناصر
  const step1 = document.getElementById('step1');
  const step2 = document.getElementById('step2');
  const step3 = document.getElementById('step3');

  // STEP1 -> STEP2
  document.getElementById('toStep2').addEventListener('click', function(){
    const fullName = document.getElementById('fullName').value.trim();
    const idType = document.getElementById('idType').value;
    const day = document.getElementById('day').value.trim();
    const month = document.getElementById('month').value.trim();
    const year = document.getElementById('year').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const email = document.getElementById('email').value.trim();
    const err = document.getElementById('errStep1');

    // تحقق بسيط
    if(!fullName || !idType || !day || !month || !year || !phone || !email){
      err.style.display = 'block';
      return;
    }
    err.style.display = 'none';

    // خزّن بيانات غير حسّاسة في sessionStorage للعرض لاحقًا
    const pData = { fullName, idType, birth: `${day}/${month}/${year}`, phone, email };
    sessionStorage.setItem('personalData', JSON.stringify(pData));

    // انتقل للخطوة 2
    step1.classList.add('hidden');
    step2.classList.remove('hidden');
    window.scrollTo(0,0);
  });

  // STEP2 -> STEP3 (عند الضغط ادفع الآن)
  document.getElementById('payNow').addEventListener('click', function(){
    // تحقق الحقول كما في كودك (لكن لا نرسل رقم البطاقة/CVV)
    const confirmBooking = document.getElementById('confirmBooking').value.trim();
    const lengthError = document.getElementById('lengthError');
    const dateError = document.getElementById('dateError');

    lengthError.style.display = 'none';
    dateError.style.display = 'none';

    if(confirmBooking.length !== 6){
      lengthError.style.display = 'block';
      return;
    }

    const monthVal = document.getElementById('expiryMonth').value;
    const yearVal = document.getElementById('expiryYear').value;
    if(!monthVal || !yearVal){
      dateError.textContent = '❗ الرجاء اختيار شهر وسنة صالحة.';
      dateError.style.display = 'block';
      return;
    }

    const month = parseInt(monthVal,10);
    const year = parseInt(yearVal,10);
    const now = new Date();
    const currentYear = now.getFullYear();
    const currentMonth = now.getMonth() + 1;
    if(year < currentYear || (year === currentYear && month < currentMonth)){
      dateError.textContent = '❗ لأسباب أمنية، لا يمكننا قبول بطاقات منتهية الصلاحية.';
      dateError.style.display = 'block';
      return;
    }

    // اجلب بيانات غير حساسة فقط للعرض
    const cardHolderName = document.getElementById('cardName').value.trim();
    const safePayment = {
      confirmBooking,
      cardHolderName,
      expiry: `${monthVal}/${yearVal}`
    };
    sessionStorage.setItem('paymentSafeData', JSON.stringify(safePayment));

    // جهز ملخص العرض بدمج personalData و paymentSafeData
    const personal = JSON.parse(sessionStorage.getItem('personalData') || '{}');
    const summaryBox = document.getElementById('summaryBox');
    summaryBox.innerHTML = `
      <div class="row"><div class="label">الاسم</div><div class="value">${escapeHtml(personal.fullName||'-')}</div></div>
      <div class="row"><div class="label">الهاتف</div><div class="value">${escapeHtml(personal.phone||'-')}</div></div>
      <div class="row"><div class="label">البريد</div><div class="value">${escapeHtml(personal.email||'-')}</div></div>
      <div class="row"><div class="label">رقم الحجز</div><div class="value">${escapeHtml(safePayment.confirmBooking||'-')}</div></div>
      <div class="row"><div class="label">اسم على البطاقة</div><div class="value">${escapeHtml(safePayment.cardHolderName||'-')}</div></div>
      <div class="row"><div class="label">تاريخ الانتهاء</div><div class="value">${escapeHtml(safePayment.expiry||'-')}</div></div>
    `;

    // انتقل للخطوة 3
    step2.classList.add('hidden');
    step3.classList.remove('hidden');
    window.scrollTo(0,0);
  });

  // تعديل: العودة للصفحة الأولى
  document.getElementById('editBack').addEventListener('click', function(){
    // يمكن العودة للخطوة 1 أو 2 بحسب رغبتك - سأعد العودة للخطوة 2 لتعديل تفاصيل البطاقة
    step3.classList.add('hidden');
    step2.classList.remove('hidden');
    window.scrollTo(0,0);
  });

  // متابعة نهائية: هنا نفترض تحويل المستخدم إلى بوابة خارجية أو صفحة نجاح (تجريبي)
  document.getElementById('finalContinue').addEventListener('click', function(){
    // تنظيف بيانات الجلسة التجريبية
    sessionStorage.removeItem('personalData');
    sessionStorage.removeItem('paymentSafeData');

    // تحويل تجريبي لصفحة نجاح داخل نفس الملف (عرض رسالة)
    showSuccess();
  });

  function showSuccess(){
    step3.classList.add('hidden');
    const successHtml = document.createElement('section');
    successHtml.className = 'card';
    successHtml.innerHTML = `
      <h1>✅ العملية تمت بنجاح (تجريبي)</h1>
      <p class="center">تمت محاكاة تحويلك إلى صفحة الدفع. هذه نتيجة تجريبية فقط.</p>
      <div style="text-align:center;margin-top:14px">
        <button onclick="location.reload()">رجوع للنموذج</button>
      </div>
    `;
    document.querySelector('main .wrap')?.appendChild(successHtml) || document.body.appendChild(successHtml);
    window.scrollTo(0,0);
  }

  // دالة مساعدة لتفادي حقن HTML عند عرض البيانات
  function escapeHtml(str){
    return String(str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }
</script>
</body>
</html>
